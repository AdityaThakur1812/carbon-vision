import pandas as pd
import joblib
from sklearn.preprocessing import LabelEncoder
from sklearn.ensemble import RandomForestRegressor

# Load dataset
df = pd.read_csv("Carbon Emission.csv")

# Columns used
features = [
    "Body Type","Sex","Diet","How Often Shower",
    "Heating Energy Source","Transport","Vehicle Type",
    "Social Activity","Monthly Grocery Bill",
    "Frequency of Traveling by Air","Vehicle Monthly Distance Km",
    "Waste Bag Size","Waste Bag Weekly Count",
    "How Long TV PC Daily Hour","How Many New Clothes Monthly",
    "How Long Internet Daily Hour","Energy efficiency",
    "Recycling (Plastic)","Recycling (Paper)",
    "Recycling (Glass)","Recycling (Metal)"
]

target = "CarbonEmission"

X = df[features]
y = df[target]

# Encode categorical columns
encoders = {}
for col in X.columns:
    if X[col].dtype == "object":
        le = LabelEncoder()
        X[col] = le.fit_transform(X[col])
        encoders[col] = le

# Train model
model = RandomForestRegressor(
    n_estimators=150,
    random_state=42
)
model.fit(X, y)

# Save model & encoders
joblib.dump(model, "model.pkl")
joblib.dump(encoders, "encoders.pkl")

print("âœ… ML model trained successfully")
